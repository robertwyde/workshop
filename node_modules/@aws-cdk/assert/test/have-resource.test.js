"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cxapi = require("@aws-cdk/cx-api");
const fs_1 = require("fs");
const path_1 = require("path");
const index_1 = require("../lib/index");
test('support resource with no properties', () => {
    const synthStack = mkStack({
        Resources: {
            SomeResource: {
                Type: 'Some::Resource'
            }
        }
    });
    expect(() => index_1.expect(synthStack).to(index_1.haveResource('Some::Resource'))).not.toThrowError();
});
test('haveResource tells you about mismatched fields', () => {
    const synthStack = mkStack({
        Resources: {
            SomeResource: {
                Type: 'Some::Resource',
                Properties: {
                    PropA: 'somevalue'
                }
            }
        }
    });
    expect(() => {
        index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
            PropA: 'othervalue'
        }));
    }).toThrowError(/PropA/);
});
test('haveResource value matching is strict by default', () => {
    const synthStack = mkStack({
        Resources: {
            SomeResource: {
                Type: 'Some::Resource',
                Properties: {
                    PropA: {
                        foo: 'somevalue',
                        bar: 'This is unexpected, so the value of PropA doesn\'t strictly match - it shouldn\'t pass'
                    },
                    PropB: 'This property is unexpected, but it\'s allowed'
                }
            }
        }
    });
    expect(() => {
        index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
            PropA: {
                foo: 'somevalue'
            }
        }));
    }).toThrowError(/PropA/);
});
test('haveResource allows to opt in value extension', () => {
    const synthStack = mkStack({
        Resources: {
            SomeResource: {
                Type: 'Some::Resource',
                Properties: {
                    PropA: {
                        foo: 'somevalue',
                        bar: 'Additional value is permitted, as we opted in'
                    },
                    PropB: 'Additional properties is always okay!'
                }
            }
        }
    });
    expect(() => index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
        PropA: {
            foo: 'somevalue'
        }
    }, undefined, true))).not.toThrowError();
});
describe('property absence', () => {
    test('pass on absence', () => {
        const synthStack = mkSomeResource({
            Prop: 'somevalue'
        });
        index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
            PropA: index_1.ABSENT
        }));
    });
    test('fail on presence', () => {
        const synthStack = mkSomeResource({
            PropA: 3
        });
        expect(() => {
            index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
                PropA: index_1.ABSENT
            }));
        }).toThrowError(/PropA/);
    });
    test('pass on deep absence', () => {
        const synthStack = mkSomeResource({
            Deep: {
                Prop: 'somevalue',
            }
        });
        index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
            Deep: {
                Prop: 'somevalue',
                PropA: index_1.ABSENT
            }
        }));
    });
    test('fail on deep presence', () => {
        const synthStack = mkSomeResource({
            Deep: {
                Prop: 'somevalue',
            }
        });
        expect(() => {
            index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
                Deep: {
                    Prop: index_1.ABSENT
                }
            }));
        }).toThrowError(/Prop/);
    });
});
function mkStack(template) {
    const assembly = new cxapi.CloudAssemblyBuilder();
    assembly.addArtifact('test', {
        type: cxapi.ArtifactType.AWS_CLOUDFORMATION_STACK,
        environment: cxapi.EnvironmentUtils.format('123456789', 'us-west-2'),
        properties: {
            templateFile: 'template.json'
        }
    });
    fs_1.writeFileSync(path_1.join(assembly.outdir, 'template.json'), JSON.stringify(template));
    return assembly.buildAssembly().getStackByName('test');
}
function mkSomeResource(props) {
    return mkStack({
        Resources: {
            SomeResource: {
                Type: 'Some::Resource',
                Properties: props
            }
        }
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGF2ZS1yZXNvdXJjZS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaGF2ZS1yZXNvdXJjZS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEseUNBQXlDO0FBQ3pDLDJCQUFtQztBQUNuQywrQkFBNEI7QUFDNUIsd0NBQXlFO0FBRXpFLElBQUksQ0FBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUU7SUFDL0MsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDO1FBQ3pCLFNBQVMsRUFBRTtZQUNULFlBQVksRUFBRTtnQkFDWixJQUFJLEVBQUUsZ0JBQWdCO2FBQ3ZCO1NBQ0Y7S0FDRixDQUFDLENBQUM7SUFDSCxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsY0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxvQkFBWSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQztBQUM1RixDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyxnREFBZ0QsRUFBRSxHQUFHLEVBQUU7SUFDMUQsTUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDO1FBQ3pCLFNBQVMsRUFBRTtZQUNULFlBQVksRUFBRTtnQkFDWixJQUFJLEVBQUUsZ0JBQWdCO2dCQUN0QixVQUFVLEVBQUU7b0JBQ1YsS0FBSyxFQUFFLFdBQVc7aUJBQ25CO2FBQ0Y7U0FDRjtLQUNGLENBQUMsQ0FBQztJQUVILE1BQU0sQ0FBQyxHQUFHLEVBQUU7UUFDVixjQUFTLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBRSxDQUFDLG9CQUFZLENBQUMsZ0JBQWdCLEVBQUU7WUFDdEQsS0FBSyxFQUFFLFlBQVk7U0FDcEIsQ0FBQyxDQUFDLENBQUM7SUFDTixDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDM0IsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsa0RBQWtELEVBQUUsR0FBRyxFQUFFO0lBQzVE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QkFDdEIsVUFBVSxFQUFFLEtBQUs7YUFDbEI7U0FDRjtLQUNGLENBQUMsQ0FBQztBQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBjeGFwaSBmcm9tICdAYXdzLWNkay9jeC1hcGknO1xuaW1wb3J0IHsgd3JpdGVGaWxlU3luYyB9IGZyb20gJ2ZzJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICdwYXRoJztcbmltcG9ydCB7IEFCU0VOVCwgZXhwZWN0IGFzIGNka0V4cGVjdCwgaGF2ZVJlc291cmNlIH0gZnJvbSAnLi4vbGliL2luZGV4JztcblxudGVzdCgnc3VwcG9ydCByZXNvdXJjZSB3aXRoIG5vIHByb3BlcnRpZXMnLCAoKSA9PiB7XG4gIGNvbnN0IHN5bnRoU3RhY2sgPSBta1N0YWNrKHtcbiAgICBSZXNvdXJjZXM6IHtcbiAgICAgIFNvbWVSZXNvdXJjZToge1xuICAgICAgICBUeXBlOiAnU29tZTo6UmVzb3VyY2UnXG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgZXhwZWN0KCgpID0+IGNka0V4cGVjdChzeW50aFN0YWNrKS50byhoYXZlUmVzb3VyY2UoJ1NvbWU6OlJlc291cmNlJykpKS5ub3QudG9UaHJvd0Vycm9yKCk7XG59KTtcblxudGVzdCgnaGF2ZVJlc291cmNlIHRlbGxzIHlvdSBhYm91dCBtaXNtYXRjaGVkIGZpZWxkcycsICgpID0+IHtcbiAgY29uc3Qgc3ludGhTdGFjayA9IG1rU3RhY2soe1xuICAgIFJlc291cmNlczoge1xuICAgICAgU29tZVJlc291cmNlOiB7XG4gICAgICAgIFR5cGU6ICdTb21lOjpSZXNvdXJjZScsXG4gICAgICAgIFByb3BlcnRpZXM6IHtcbiAgICAgICAgICBQcm9wQTogJ3NvbWV2YWx1ZSdcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgZXhwZWN0KCgpID0+IHtcbiAgICBjZGtFeHBlY3Qoc3ludGhTdGFjaykudG8oaGF2ZVJlc291cmNlKCdTb21lOjpSZXNvdXJjZScsIHtcbiAgICAgIFByb3BBOiAnb3RoZXJ2YWx1ZSdcbiAgICB9KSk7XG4gIH0pLnRvVGhyb3dFcnJvcigvUHJvcEEvKTtcbn0pO1xuXG50ZXN0KCdoYXZlUmVzb3VyY2UgdmFsdWUgbWF0Y2hpbmcgaXMgc3RyaWN0IGJ5IGRlZmF1bHQnLCAoKSA9PiB7XG4gIGNvbnN0IHN5bnRoU3RhY2sgPSBta1N0YWNrKHtcbiAgICBSZXNvdXJjZXM6IHtcbiAgICAgIFNvbWVSZXNvdXJjZToge1xuICAgICAgICBUeXBlOiAnU29tZTo6UmVzb3VyY2UnLFxuICAgICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgUHJvcEE6IHtcbiAgICAgICAgICAgIGZvbzogJ3NvbWV2YWx1ZScsXG4gICAgICAgICAgICBiYXI6ICdUaGlzIGlzIHVuZXhwZWN0ZWQsIHNvIHRoZSB2YWx1ZSBvZiBQcm9wQSBkb2VzblxcJ3Qgc3RyaWN0bHkgbWF0Y2ggLSBpdCBzaG91bGRuXFwndCBwYXNzJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgUHJvcEI6ICdUaGlzIHByb3BlcnR5IGlzIHVuZXhwZWN0ZWQsIGJ1dCBpdFxcJ3MgYWxsb3dlZCdcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgZXhwZWN0KCgpID0+IHtcbiAgICBjZGtFeHBlY3Qoc3ludGhTdGFjaykudG8oaGF2ZVJlc291cmNlKCdTb21lOjpSZXNvdXJjZScsIHtcbiAgICAgIFByb3BBOiB7XG4gICAgICAgIGZvbzogJ3NvbWV2YWx1ZSdcbiAgICAgIH1cbiAgICB9KSk7XG4gIH0pLnRvVGhyb3dFcnJvcigvUHJvcEEvKTtcbn0pO1xuXG50ZXN0KCdoYXZlUmVzb3VyY2UgYWxsb3dzIHRvIG9wdCBpbiB2YWx1ZSBleHRlbnNpb24nLCAoKSA9PiB7XG4gIGNvbnN0IHN5bnRoU3RhY2sgPSBta1N0YWNrKHtcbiAgICBSZXNvdXJjZXM6IHtcbiAgICAgIFNvbWVSZXNvdXJjZToge1xuICAgICAgICBUeXBlOiAnU29tZTo6UmVzb3VyY2UnLFxuICAgICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgUHJvcEE6IHtcbiAgICAgICAgICAgIGZvbzogJ3NvbWV2YWx1ZScsXG4gICAgICAgICAgICBiYXI6ICdBZGRpdGlvbmFsIHZhbHVlIGlzIHBlcm1pdHRlZCwgYXMgd2Ugb3B0ZWQgaW4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBQcm9wQjogJ0FkZGl0aW9uYWwgcHJvcGVydGllcyBpcyBhbHdheXMgb2theSEnXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIGV4cGVjdCgoKSA9PlxuICAgIGNka0V4cGVjdChzeW50aFN0YWNrKS50byhoYXZlUmVzb3VyY2UoJ1NvbWU6OlJlc291cmNlJywge1xuICAgICAgUHJvcEE6IHtcbiAgICAgICAgZm9vOiAnc29tZXZhbHVlJ1xuICAgICAgfVxuICAgIH0sIHVuZGVmaW5lZCwgdHJ1ZSkpXG4gICkubm90LnRvVGhyb3dFcnJvcigpO1xufSk7XG5cbmRlc2NyaWJlKCdwcm9wZXJ0eSBhYnNlbmNlJywgKCkgPT4ge1xuICB0ZXN0KCdwYXNzIG9uIGFic2VuY2UnLCAoKSA9PiB7XG4gICAgY29uc3Qgc3ludGhTdGFjayA9IG1rU29tZVJlc291cmNlKHtcbiAgICAgIFByb3A6ICdzb21ldmFsdWUnXG4gICAgfSk7XG5cbiAgICBjZGtFeHBlY3Qoc3ludGhTdGFjaykudG8oaGF2ZVJlc291cmNlKCdTb21lOjpSZXNvdXJjZScsIHtcbiAgICAgIFByb3BBOiBBQlNFTlRcbiAgICB9KSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2ZhaWwgb24gcHJlc2VuY2UnLCAoKSA9PiB7XG4gICAgY29uc3Qgc3ludGhTdGFjayA9IG1rU29tZVJlc291cmNlKHtcbiAgICAgIFByb3BBOiAzXG4gICAgfSk7XG5cbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgY2RrRXhwZWN0KHN5bnRoU3RhY2spLnRvKGhhdmVSZXNvdXJjZSgnU29tZTo6UmVzb3VyY2UnLCB7XG4gICAgICAgIFByb3BBOiBBQlNFTlRcbiAgICAgIH0pKTtcbiAgICB9KS50b1Rocm93RXJyb3IoL1Byb3BBLyk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Bhc3Mgb24gZGVlcCBhYnNlbmNlJywgKCkgPT4ge1xuICAgIGNvbnN0IHN5bnRoU3RhY2sgPSBta1NvbWVSZXNvdXJjZSh7XG4gICAgICBEZWVwOiB7XG4gICAgICAgIFByb3A6ICdzb21ldmFsdWUnLFxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY2RrRXhwZWN0KHN5bnRoU3RhY2spLnRvKGhhdmVSZXNvdXJjZSgnU29tZTo6UmVzb3VyY2UnLCB7XG4gICAgICBEZWVwOiB7XG4gICAgICAgIFByb3A6ICdzb21ldmFsdWUnLFxuICAgICAgICBQcm9wQTogQUJTRU5UXG4gICAgICB9XG4gICAgfSkpO1xuICB9KTtcblxuICB0ZXN0KCdmYWlsIG9uIGRlZXAgcHJlc2VuY2UnLCAoKSA9PiB7XG4gICAgY29uc3Qgc3ludGhTdGFjayA9IG1rU29tZVJlc291cmNlKHtcbiAgICAgIERlZXA6IHtcbiAgICAgICAgUHJvcDogJ3NvbWV2YWx1ZScsXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgY2RrRXhwZWN0KHN5bnRoU3RhY2spLnRvKGhhdmVSZXNvdXJjZSgnU29tZTo6UmVzb3VyY2UnLCB7XG4gICAgICAgIERlZXA6IHtcbiAgICAgICAgICBQcm9wOiBBQlNFTlRcbiAgICAgICAgfVxuICAgICAgfSkpO1xuICAgIH0pLnRvVGhyb3dFcnJvcigvUHJvcC8pO1xuICB9KTtcblxufSk7XG5cbmZ1bmN0aW9uIG1rU3RhY2sodGVtcGxhdGU6IGFueSk6IGN4YXBpLkNsb3VkRm9ybWF0aW9uU3RhY2tBcnRpZmFjdCB7XG4gIGNvbnN0IGFzc2VtYmx5ID0gbmV3IGN4YXBpLkNsb3VkQXNzZW1ibHlCdWlsZGVyKCk7XG4gIGFzc2VtYmx5LmFkZEFydGlmYWN0KCd0ZXN0Jywge1xuICAgIHR5cGU6IGN4YXBpLkFydGlmYWN0VHlwZS5BV1NfQ0xPVURGT1JNQVRJT05fU1RBQ0ssXG4gICAgZW52aXJvbm1lbnQ6IGN4YXBpLkVudmlyb25tZW50VXRpbHMuZm9ybWF0KCcxMjM0NTY3ODknLCAndXMtd2VzdC0yJyksXG4gICAgcHJvcGVydGllczoge1xuICAgICAgdGVtcGxhdGVGaWxlOiAndGVtcGxhdGUuanNvbidcbiAgICB9XG4gIH0pO1xuXG4gIHdyaXRlRmlsZVN5bmMoam9pbihhc3NlbWJseS5vdXRkaXIsICd0ZW1wbGF0ZS5qc29uJyksIEpTT04uc3RyaW5naWZ5KHRlbXBsYXRlKSk7XG4gIHJldHVybiBhc3NlbWJseS5idWlsZEFzc2VtYmx5KCkuZ2V0U3RhY2tCeU5hbWUoJ3Rlc3QnKTtcbn1cblxuZnVuY3Rpb24gbWtTb21lUmVzb3VyY2UocHJvcHM6IGFueSk6IGN4YXBpLkNsb3VkRm9ybWF0aW9uU3RhY2tBcnRpZmFjdCB7XG4gIHJldHVybiBta1N0YWNrKHtcbiAgICBSZXNvdXJjZXM6IHtcbiAgICAgIFNvbWVSZXNvdXJjZToge1xuICAgICAgICBUeXBlOiAnU29tZTo6UmVzb3VyY2UnLFxuICAgICAgICBQcm9wZXJ0aWVzOiBwcm9wc1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59Il19